"""
æ¸¬è©¦ä¿®æ”¹å¾Œçš„å¤šç¯‡æ–‡ç« åˆ†ç™¼åŠŸèƒ½
"""

from line_handler import LINENewsBot
from unittest.mock import Mock
import logging

# è¨­ç½®æ—¥èªŒè¼¸å‡ºåˆ°æ§åˆ¶å°
logging.basicConfig(level=logging.INFO, format='%(levelname)s - %(message)s')

def test_multiple_articles():
    print("ğŸ§ª æ¸¬è©¦ä¿®æ”¹å¾Œçš„å¤šç¯‡æ–‡ç« åˆ†ç™¼åŠŸèƒ½")
    print("=" * 60)
    
    # æ¨¡æ“¬ LINE Botï¼ˆä¸éœ€è¦çœŸå¯¦çš„ API Tokenï¼‰
    try:
        # æ¨¡æ“¬æ¸¬è©¦è³‡æ–™
        test_articles = [
            {
                'title': 'AI æŠ€è¡“çªç ´ï¼šGPT-5 å³å°‡ç™¼å¸ƒ',
                'summary': 'æ ¹æ“šæœ€æ–°æ¶ˆæ¯ï¼ŒOpenAI æ­£åœ¨é–‹ç™¼ä¸‹ä¸€ä»£å¤§èªè¨€æ¨¡å‹ GPT-5ï¼Œé è¨ˆå°‡åœ¨è‡ªç„¶èªè¨€ç†è§£ã€æ¨ç†èƒ½åŠ›å’Œå¤šæ¨¡æ…‹è™•ç†æ–¹é¢å¯¦ç¾é‡å¤§çªç ´ã€‚æ–°æ¨¡å‹å°‡å…·å‚™æ›´å¼·çš„é‚è¼¯æ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤ è™•ç†æ›´è¤‡é›œçš„ä»»å‹™ï¼ŒåŒæ™‚åœ¨å®‰å…¨æ€§å’Œå¯æ§æ€§æ–¹é¢ä¹Ÿæœ‰é¡¯è‘—æ”¹å–„ã€‚æ¥­ç•Œå°ˆå®¶èªç‚ºï¼ŒGPT-5 çš„ç™¼å¸ƒå°‡é‡æ–°å®šç¾©äººå·¥æ™ºæ…§çš„æ‡‰ç”¨é‚Šç•Œã€‚',
                'url': 'https://buzzorange.com/techorange/ai-gpt5-release'
            },
            {
                'title': 'é‡å­è¨ˆç®—æ–°çªç ´ï¼šIBM ç™¼è¡¨ 1000 é‡å­ä½å…ƒè™•ç†å™¨',
                'summary': 'IBM åœ¨é‡å­è¨ˆç®—é ˜åŸŸå†æ¬¡å–å¾—é‡å¤§çªç ´ï¼ŒæˆåŠŸé–‹ç™¼å‡ºæ“æœ‰ 1000 å€‹é‡å­ä½å…ƒçš„è™•ç†å™¨ Quantum Condorã€‚é€™é …æŠ€è¡“é€²å±•æ¨™èªŒè‘—é‡å­è¨ˆç®—å‘å¯¦ç”¨åŒ–é‚é€²äº†é‡è¦ä¸€æ­¥ã€‚æ–°è™•ç†å™¨åœ¨éŒ¯èª¤ç‡æ§åˆ¶å’Œé‹ç®—ç©©å®šæ€§æ–¹é¢éƒ½æœ‰é¡¯è‘—æå‡ï¼Œç‚ºè§£æ±ºè—¥ç‰©ç™¼ç¾ã€é‡‘èå»ºæ¨¡ã€æ°£å€™é æ¸¬ç­‰è¤‡é›œå•é¡Œæä¾›äº†å¼·å¤§çš„è¨ˆç®—èƒ½åŠ›ã€‚',
                'url': 'https://buzzorange.com/techorange/ibm-quantum-1000-qubits'
            },
            {
                'title': 'å…ƒå®‡å®™èˆ‡Web3èåˆï¼šè™›æ“¬ç¶“æ¿Ÿæ–°æ¨¡å¼',
                'summary': 'éš¨è‘—å…ƒå®‡å®™æŠ€è¡“çš„æˆç†Ÿå’ŒWeb3æ¦‚å¿µçš„æ™®åŠï¼Œè™›æ“¬ä¸–ç•Œä¸­çš„ç¶“æ¿Ÿæ¨¡å¼æ­£åœ¨ç™¼ç”Ÿæ ¹æœ¬æ€§è®Šé©ã€‚å€å¡ŠéˆæŠ€è¡“ä½¿å¾—è™›æ“¬è³‡ç”¢çš„çœŸæ­£æ‰€æœ‰æ¬Šæˆç‚ºå¯èƒ½ï¼ŒNFTå’Œå»ä¸­å¿ƒåŒ–é‡‘è(DeFi)ç‚ºç”¨æˆ¶æä¾›äº†å…¨æ–°çš„åƒ¹å€¼å‰µé€ å’Œäº¤æ›æ–¹å¼ã€‚å°ˆå®¶é æ¸¬ï¼Œé€™ç¨®èåˆå°‡å‰µé€ å‡ºå‰æ‰€æœªæœ‰çš„æ•¸ä½ç¶“æ¿Ÿç”Ÿæ…‹ç³»çµ±ã€‚',
                'url': 'https://buzzorange.com/techorange/metaverse-web3-economy'
            }
        ]
        
        print("ğŸ“Š æ¸¬è©¦è³‡æ–™æº–å‚™å®Œæˆï¼š")
        for i, article in enumerate(test_articles, 1):
            print(f"   {i}. {article['title']} (æ‘˜è¦é•·åº¦: {len(article['summary'])} å­—)")
        
        print(f"\nğŸ”„ æ¨¡æ“¬ç™¼é€æµç¨‹ï¼š")
        print(f"1ï¸âƒ£ ç¸½çµè¨Šæ¯ï¼šæ‰¾åˆ° {len(test_articles)} ç¯‡æ–‡ç« ")
        
        for i, article in enumerate(test_articles, 1):
            print(f"\n2ï¸âƒ£ æ–‡ç«  {i} è¨Šæ¯é è¦½ï¼š")
            print("-" * 40)
            
            # æ¨¡æ“¬å–®ç¯‡æ–‡ç« è¨Šæ¯æ ¼å¼
            title = article['title']
            summary = article['summary']
            url = article['url']
            
            message_preview = f"ğŸ“° æ–‡ç«  {i}\n\n"
            message_preview += f"ğŸ“ æ¨™é¡Œï¼š{title}\n\n"
            message_preview += f"ğŸ¤– AI æ‘˜è¦ï¼š\n{summary}\n\n"
            message_preview += f"ğŸ”— é–±è®€å…¨æ–‡ï¼š{url}"
            
            print(message_preview)
            print(f"\nğŸ“ è¨Šæ¯é•·åº¦ï¼š{len(message_preview)} å­—ç¬¦")
            
            if len(message_preview) <= 5000:
                print("âœ… è¨Šæ¯é•·åº¦ç¬¦åˆ LINE é™åˆ¶")
            else:
                print("âš ï¸ è¨Šæ¯éé•·ï¼Œéœ€è¦æˆªæ–·")
        
        print(f"\nğŸ¯ æ”¹å–„æ•ˆæœï¼š")
        print("âœ… æ¯ç¯‡æ–‡ç« ç¨ç«‹ç™¼é€ï¼Œé¿å…å…§å®¹æˆªæ–·")
        print("âœ… å®Œæ•´é¡¯ç¤º AI æ‘˜è¦ï¼ˆ100-200å­—ï¼‰")
        print("âœ… æ¸…æ™°çš„æ ¼å¼åŒ–å±•ç¤º")
        print("âœ… æ¯ç¯‡æ–‡ç« éƒ½æœ‰å®Œæ•´çš„é€£çµ")
        
        return True
        
    except Exception as e:
        print(f"âŒ æ¸¬è©¦å¤±æ•—: {str(e)}")
        return False

if __name__ == "__main__":
    success = test_multiple_articles()
    
    print("\n" + "=" * 60)
    if success:
        print("ğŸ‰ å¤šç¯‡æ–‡ç« åˆ†ç™¼åŠŸèƒ½æ¸¬è©¦é€šéï¼")
        print("ğŸ’¡ ç¾åœ¨æ¯ç¯‡æ–‡ç« éƒ½æœƒç¨ç«‹ç™¼é€ï¼Œå®Œæ•´é¡¯ç¤ºæ‘˜è¦")
        print("ğŸ“± å¯ä»¥åœ¨ LINE ä¸­æ¸¬è©¦å¤šç¯‡æ–‡ç« çš„é¡¯ç¤ºæ•ˆæœ")
    else:
        print("âŒ æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯")
        
    print("\nğŸ”„ ä¿®æ”¹å·²è‡ªå‹•ç”Ÿæ•ˆï¼ˆFlask debug æ¨¡å¼ï¼‰")
    print("ğŸ“ ç¾åœ¨åœ¨ LINE ä¸­æœå°‹é—œéµå­—ï¼Œå¤šç¯‡æ–‡ç« æœƒåˆ†åˆ¥ç™¼é€ï¼")
